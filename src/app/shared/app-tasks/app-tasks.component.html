<ng-template #deleteGroupTemplate let-tooltip="tooltip" let-groupIndex="groupIndex">
  <p>Are you sure to delete it?</p>
  <div class="bx--tooltip__footer">
    <button ibmButton="tertiary" size="sm" (click)="tooltip.doClose();onDeleteGroup(groupIndex)">Delete</button>
  </div>
</ng-template>

<!--<button (click)="onAddList()" ibmButton="tertiary" size="sm">
  Add list
  <svg class="bx&#45;&#45;btn__icon" ibmIconAdd size="20"></svg>
</button>-->
<div class=""
     cdkDropList
     [cdkDropListData]="taskGroups"
     (cdkDropListDropped)="dropGroup($event)">
  <ng-container *ngFor="let group of taskGroups;let groupIndex=index">
    <div cdkDropListGroup
         cdkDrag
         [cdkDragData]="group"
         [ngClass]="{'app-bg-ui app-list--border-over':!transparent}"
         class="app-list app-list--todo mb-3">
      <div class="app-list__group">
        <div>
          <div class="app-list__item">
            <div>
              <button (click)="onToggleGroup(groupIndex)"
                      ibmButton="ghost" size="sm" class="bx--btn--icon-only">
                <ng-container *ngIf="group.opened">
                  <svg class="bx--btn__icon" ibmIconChevronDown size="32"></svg>
                </ng-container>
                <ng-container *ngIf="!group.opened">
                  <svg class="bx--btn__icon" ibmIconChevronUp size="32"></svg>
                </ng-container>
              </button>
            </div>
            <div class="app-list__item__content">
              <ng-container *ngIf="taskFocusId === group.id">
                <input cdkTrapFocus
                       cdkTrapFocusAutoCapture
                       placeholder="List description..."
                       class="flex-1 app-list__item__input app-expressive-heading-02"
                       type="text"
                       (input)="onGroupChange($event.target.value,groupIndex)"
                       [value]="group.groupName"/>
              </ng-container>
              <ng-container *ngIf="taskFocusId !== group.id">
                <input class="flex-1 app-list__item__input app-expressive-heading-02"
                       type="text"
                       placeholder="List description..."
                       (input)="onGroupChange($event.target.value,groupIndex)"
                       [value]="group.groupName"/>
              </ng-container>
            </div>
            <div class="flex items-center">
              <div class="cursor-move">
                <app-ibm-icon cdkDragHandle iconName="draggable" iconSize="16"></app-ibm-icon>
              </div>
              <button [ibmTooltip]="deleteGroupTemplate"
                      [offset]="{x:0,y:0}"
                      [trigger]="'click'"
                      [placement]="'bottom'"
                      ibmButton="ghost" size="sm" class="bx--btn--icon-only bx--btn--remove-tooltip">
                <svg class="bx--btn__icon" ibmIconTrashCan size="32"></svg>
              </button>
            </div>
          </div>
        </div>
        <div cdkDropList
             id={{group.id}}
             [cdkDropListData]="group.tasks"
             (cdkDropListDropped)="drop($event)"
             [cdkDropListConnectedTo]="getConnectedList()"
             [ngClass]="{'hidden':!group.opened}"
             class="app-list__group__children">
          <ng-container *ngFor="let task of group.tasks;let taskIndex=index">
            <div cdkDrag [cdkDragData]="task" class="app-list__item">
              <div cdkDragHandle class="app-list__item__drag">
                <app-ibm-icon iconName="draggable" iconSize="16"></app-ibm-icon>
              </div>
              <div class="mr-1">
                <ibm-checkbox
                  (change)="onToggleTask($event,groupIndex,taskIndex)"
                  [checked]="task.checked">
                </ibm-checkbox>
              </div>
              <ng-container *ngIf="task.checked">
                <div class="app-list__item__content">
                  <div
                    class="flex-1 app-list__item__input app-body-short-01 line-through text-muted">{{task.description}}</div>
                </div>
              </ng-container>
              <ng-container *ngIf="!task.checked">
                <div class="app-list__item__content">
                  <ng-container *ngIf="taskFocusId === task.id">
                    <input class="flex-1 app-list__item__input app-body-short-01"
                           placeholder="Task description..."
                           cdkTrapFocus
                           cdkTrapFocusAutoCapture
                           type="text"
                           (input)="onTaskChange($event.target.value,groupIndex,taskIndex)"
                           [value]="task.description"/>
                  </ng-container>
                  <ng-container *ngIf="taskFocusId !== task.id">
                    <input class="flex-1 app-list__item__input app-body-short-01"
                           placeholder="Task description..."
                           type="text"
                           (input)="onTaskChange($event.target.value,groupIndex,taskIndex)"
                           [value]="task.description"/>
                  </ng-container>
                </div>
              </ng-container>
            </div>
          </ng-container>
          <div class="app-list__add-btn">
            <button (click)="onAddTask(groupIndex)" ibmButton="tertiary" size="sm">
              Add task
              <svg class="bx--btn__icon" ibmIconAdd size="20"></svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</div>
